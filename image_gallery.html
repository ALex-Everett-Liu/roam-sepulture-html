<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery</title>
    <style>
        :root {
            --primary-color: #2a4b8d;
            --secondary-color: #4a5568;
            --accent-color: #3182ce;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --text-color: #2d3748;
            --border-color: #e2e8f0;
            --tag-bg: #e2e8f0;
            --tag-hover: #cbd5e0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--bg-color);
            color: var(--text-color);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .sort-controls, .filter-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sort-controls select, .filter-controls input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
        }
        
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }
        
        .tag {
            background: var(--tag-bg);
            color: var(--text-color);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }
        
        .tag:hover {
            background: var(--tag-hover);
            transform: translateY(-1px);
        }
        
        .tag.active {
            background: var(--accent-color);
            color: white;
        }
        
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
            background: white;
        }
        
        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .gallery-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }
        
        .gallery-item .placeholder {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            height: 200px;
        }
        
        /* Custom sizing classes */
        .gallery-item.tall {
            grid-row: span 2;
        }
        
        .gallery-item.wide {
            grid-column: span 2;
        }
        
        .gallery-item.extra-wide {
            grid-column: span 3;
        }
        
        .gallery-item.full-width {
            grid-column: span 4;
        }
        
        .gallery-item.mini {
            max-width: 150px;
        }
        
        .gallery-item.small {
            max-width: 200px;
        }
        
        .gallery-item.medium {
            max-width: 350px;
        }
        
        .gallery-item.large {
            max-width: 500px;
        }
        
        .gallery-item .caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            padding: 15px;
            font-size: 14px;
        }
        
        .gallery-item .ranking {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .gallery-item .image-tags {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        
        .image-tag {
            background: var(--tag-bg);
            color: var(--text-color);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: var(--accent-color);
            text-decoration: none;
            font-weight: bold;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .clear-filters {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 5px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .clear-filters:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }
        
        @media (max-width: 768px) {
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        @media (max-width: 480px) {
            .gallery {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Index</a>
        <h1>Image Gallery</h1>
        <p>Browse through various images and photos. Sort by ranking and filter by tags to find exactly what you're looking for.</p>
        
        <div class="controls">
            <div class="sort-controls">
                <label for="sort-select">Sort by:</label>
                <select id="sort-select">
                    <option value="ranking-asc">Ranking (Low to High)</option>
                    <option value="ranking-desc">Ranking (High to Low)</option>
                    <option value="name-asc">Name (A to Z)</option>
                    <option value="name-desc">Name (Z to A)</option>
                </select>
            </div>
            
            <div class="filter-controls">
                <label>Filter by tags:</label>
                <input type="text" id="tag-search" placeholder="Search tags...">
                <button class="clear-filters" onclick="clearAllFilters()">Clear Filters</button>
            </div>
        </div>
        
        <div class="tag-cloud" id="tag-cloud"></div>
        
        <div class="gallery" id="gallery">
            <!-- Images will be populated by JavaScript -->
        </div>
        
        <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
            <h3>Gallery Management</h3>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button onclick="refreshGallery()" style="padding: 8px 16px; background: var(--accent-color); color: white; border: none; border-radius: 6px; cursor: pointer;">
                    üîÑ Refresh Gallery
                </button>
                <button onclick="exportGalleryData()" style="padding: 8px 16px; background: var(--secondary-color); color: white; border: none; border-radius: 6px; cursor: pointer;">
                    üì§ Export Data
                </button>
                <button onclick="importGalleryData()" style="padding: 8px 16px; background: var(--secondary-color); color: white; border: none; border-radius: 6px; cursor: pointer;">
                    üì• Import Data
                </button>
            </div>
            
            <h4>How to manage your gallery:</h4>
            <p><strong>1. Edit JSON file:</strong> Modify <code>images_data.json</code> to add/update images</p>
            <p><strong>2. Import/Export:</strong> Use the buttons above to manage your gallery data</p>
            <p><strong>3. Add images:</strong> Update image paths in the JSON file</p>
            <p><strong>4. Structure:</strong> Each image needs: title, description, src, ranking, and tags</p>
            
            <details style="margin-top: 15px;">
                <summary style="cursor: pointer; color: var(--accent-color);">JSON Format Example</summary>
                <pre style="background: #f1f3f4; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px;">{
  "images": [
    {
      "id": 1,
      "title": "Your Image Title",
      "description": "Image description",
      "src": "path/to/your/image.jpg",
      "ranking": 8.5,
      "tags": ["nature", "landscape"],
      "width": "400px",
      "height": "300px",
      "gridSpan": 2
    }
  ]
}</pre>
                <p style="margin-top: 10px; font-size: 0.9rem; color: var(--secondary-color);">
                    <strong>Optional fields:</strong> width, height (custom dimensions), gridSpan (1-4 columns)
                </p>
            </details>
        </div>
    </div>

    <script>
        // Fallback data in case JSON file fails to load
        const fallbackImages = [
            {
                id: 1,
                title: "Sunset Landscape",
                description: "Beautiful sunset over mountains",
                src: null,
                ranking: 9.25,
                tags: ["landscape", "sunset", "nature", "mountains"]
            },
            {
                id: 2,
                title: "City Skyline",
                description: "Modern city skyline at night",
                src: null,
                ranking: 8.75,
                tags: ["city", "urban", "night", "skyline"]
            },
            {
                id: 3,
                title: "Ocean Waves",
                description: "Peaceful ocean waves at dawn",
                src: null,
                ranking: 7.8,
                tags: ["ocean", "water", "dawn", "peaceful"]
            }
        ];

        // Global variables
        let images = [];
        let filteredImages = [];
        let currentSort = 'ranking-desc';
        let selectedTags = [];
        let tagSearchQuery = '';
        let isLoading = true;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadImageData();
            setupEventListeners();
        });

        // Load image data from external JSON file
        async function loadImageData() {
            try {
                const response = await fetch('private-pages-01/images_data_sample.json');
                if (!response.ok) {
                    throw new Error('Failed to load image data');
                }
                const data = await response.json();
                images = data.images || fallbackImages;
                
                // Update UI with loaded data
                renderTagCloud();
                renderGallery();
                
                console.log(`Successfully loaded ${images.length} images`);
            } catch (error) {
                console.warn('Failed to load external JSON, using fallback data:', error);
                images = fallbackImages;
                renderTagCloud();
                renderGallery();
            } finally {
                isLoading = false;
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('sort-select').addEventListener('change', handleSort);
            document.getElementById('tag-search').addEventListener('input', handleTagSearch);
        }

        // Show loading state
        function showLoadingState() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: var(--secondary-color);">
                    <div style="font-size: 2rem; margin-bottom: 20px;">üì∏</div>
                    <h3>Loading gallery...</h3>
                    <p>Please wait while we load your images.</p>
                </div>
            `;
        }

        // Render tag cloud
        function renderTagCloud() {
            const tagCloud = document.getElementById('tag-cloud');
            if (!images || images.length === 0) {
                tagCloud.innerHTML = '<span style="color: var(--secondary-color);">No tags available</span>';
                return;
            }
            
            const allTags = [...new Set(images.flatMap(img => img.tags))].sort();
            
            tagCloud.innerHTML = '';
            allTags.forEach(tag => {
                const tagElement = document.createElement('button');
                tagElement.className = 'tag';
                tagElement.textContent = tag;
                tagElement.onclick = () => toggleTag(tag, tagElement);
                tagCloud.appendChild(tagElement);
            });
        }

        // Toggle tag selection
        function toggleTag(tag, element) {
            const index = selectedTags.indexOf(tag);
            if (index > -1) {
                selectedTags.splice(index, 1);
                element.classList.remove('active');
            } else {
                selectedTags.push(tag);
                element.classList.add('active');
            }
            filterAndRender();
        }

        // Handle sort change
        function handleSort(event) {
            currentSort = event.target.value;
            filterAndRender();
        }

        // Handle tag search
        function handleTagSearch(event) {
            tagSearchQuery = event.target.value.toLowerCase();
            const tags = document.querySelectorAll('.tag');
            
            tags.forEach(tag => {
                if (tag.textContent.toLowerCase().includes(tagSearchQuery)) {
                    tag.style.display = 'inline-block';
                } else {
                    tag.style.display = 'none';
                }
            });
        }

        // Filter and sort images
        function filterAndSortImages() {
            if (!images || images.length === 0) return;
            
            // Filter by tags
            filteredImages = images.filter(img => {
                if (selectedTags.length === 0) return true;
                return selectedTags.every(tag => img.tags.includes(tag));
            });

            // Sort images
            filteredImages.sort((a, b) => {
                switch (currentSort) {
                    case 'ranking-asc':
                        return a.ranking - b.ranking;
                    case 'ranking-desc':
                        return b.ranking - a.ranking;
                    case 'name-asc':
                        return a.title.localeCompare(b.title);
                    case 'name-desc':
                        return b.title.localeCompare(a.title);
                    default:
                        return 0;
                }
            });
        }

        // Render gallery
        function renderGallery() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';

            if (filteredImages.length === 0) {
                gallery.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--secondary-color);">
                        <h3>No images found</h3>
                        <p>Try adjusting your filters or search criteria.</p>
                    </div>
                `;
                return;
            }

            filteredImages.forEach(img => {
                const item = document.createElement('div');
                let classes = 'gallery-item';
                
                // Add custom grid span classes based on gridSpan
                if (img.gridSpan) {
                    if (img.gridSpan === 2) classes += ' wide';
                    else if (img.gridSpan === 3) classes += ' extra-wide';
                    else if (img.gridSpan >= 4) classes += ' full-width';
                }
                
                // Determine height class based on custom height
                let imgStyle = '';
                let placeholderStyle = '';
                
                if (img.height) {
                    imgStyle = `style="width: 100%; height: ${img.height}; object-fit: cover;"`;
                    placeholderStyle = `style="height: ${img.height};"`;
                }
                
                const imgWidth = img.width || '100%';
                const imgHeight = img.height || '200px';
                
                item.className = classes;
                
                item.innerHTML = `
                    ${img.src ? 
                        `<img src="${img.src}" alt="${img.title}" style="width: 100%; height: ${imgHeight}; object-fit: cover;">` : 
                        `<div class="placeholder" style="height: ${imgHeight}">${img.title}</div>`
                    }
                    <div class="ranking">‚≠ê ${img.ranking}</div>
                    <div class="caption">
                        ${img.title}
                        <div>${img.description}</div>
                        <div class="image-tags">
                            ${img.tags.map(tag => `<span class="image-tag">${tag}</span>`).join('')}
                        </div>
                        ${img.width || img.height ? 
                            `<div style="margin-top: 5px; font-size: 0.7rem; opacity: 0.8;">
                                ${img.width} √ó ${img.height || 'auto'}
                            </div>` : ''
                        }
                    </div>
                `;
                
                gallery.appendChild(item);
            });
        }

        // Export current gallery data to JSON
        function exportGalleryData() {
            const exportData = {
                images: images,
                metadata: {
                    version: "1.0",
                    exportedAt: new Date().toISOString(),
                    totalImages: images.length,
                    availableTags: [...new Set(images.flatMap(img => img.tags))].sort()
                }
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'gallery_data_export.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Import gallery data from JSON file
        function importGalleryData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.images && Array.isArray(data.images)) {
                            images = data.images;
                            selectedTags = [];
                            filterAndRender();
                            alert(`Successfully imported ${images.length} images`);
                        } else {
                            alert('Invalid file format. Please select a valid gallery JSON file.');
                        }
                    } catch (error) {
                        alert('Error reading file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Manual refresh function
        function refreshGallery() {
            loadImageData();
        }

        // Clear all filters
        function clearAllFilters() {
            selectedTags = [];
            tagSearchQuery = '';
            document.getElementById('tag-search').value = '';
            document.getElementById('sort-select').value = 'ranking-desc';
            
            document.querySelectorAll('.tag').forEach(tag => {
                tag.classList.remove('active');
                tag.style.display = 'inline-block';
            });
            
            filterAndRender();
        }

        // Filter and render
        function filterAndRender() {
            filterAndSortImages();
            renderGallery();
        }
    </script>
</body>
</html>